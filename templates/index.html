<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BNL1T Event Display Web</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    <div class="container">
        <header>
            <h1>BNL30T Analysis & Display Web App</h1>
        </header>

        <section id="file-loader">
            <input type="text" id="file-path" placeholder="/path/to/file.root"
                value="/home/guang/work/bnl1t/drop/drop_jan26_24_pull/data_30ton/majority_test_251031T0706_0.root">
            <button onclick="loadFile()">Load File</button>
            <span style="margin: 0 10px;">OR</span>
            <input type="file" id="upload-file">
            <button onclick="uploadFile()">Upload & Load</button>
            <span id="file-status">No file loaded</span>
            <span id="event-range"></span>
        </section>

        <div class="tabs">
            <button class="tab-btn" onclick="openTab('histogram')">Histogram</button>
            <button class="tab-btn" onclick="openTab('triggered-events')">Triggered Events</button>
            <button class="tab-btn" onclick="openTab('event-display')">Event Display</button>
            <button class="tab-btn" onclick="openTab('waveform')">Waveform</button>
        </div>

        <div id="histogram" class="tab-content active">
            <div class="controls">
                <div class="input-group">
                    <label for="hist-channels">Channels:</label>
                    <input type="text" id="hist-channels" value="b1ch0, b1ch2-8, b1ch10-15, b2ch0-15, b3ch0-3"
                        placeholder="e.g. b1ch0, b1ch2-8">
                </div>
                <div class="input-group">
                    <label for="hist-trigger">Trigger:</label>
                    <input type="text" id="hist-trigger" value="b4ch9-12, b4ch18-21" placeholder="e.g. b4ch9-12">
                </div>
                <button onclick="generateHistogram()">Generate Histogram</button>
            </div>

            <div class="help-text"
                style="margin-top: 10px; font-size: 0.9em; color: #555; background: #f9f9f9; padding: 10px; border-radius: 5px;">
                <p><strong>Explanation:</strong></p>
                <ul>
                    <li><strong>Trigger:</strong> The channel(s) used to decide if an event is kept. An event is saved
                        if the signal in this channel exceeds 100 mV.</li>
                    <li><strong>Channels:</strong> The channel(s) whose data is plotted (Integrated Charge).</li>
                </ul>
            </div>

            <div id="histogram-plot" class="plot-container">
                <!-- Plot will appear here -->
            </div>
        </div>

        <div id="triggered-events" class="tab-content">
            <div class="controls">
                <div class="input-group">
                    <label for="grid-trigger">Trigger:</label>
                    <input type="text" id="grid-trigger" value="b4ch9" placeholder="e.g. b4ch9">
                </div>
                <button onclick="generateEventGrid()">Generate 3D Event Grid</button>
            </div>
            <div class="help-text"
                style="margin-top: 10px; font-size: 0.9em; color: #555; background: #f9f9f9; padding: 10px; border-radius: 5px;">
                <p><strong>Explanation:</strong> Displays a 3D view of the first 9 events that pass the trigger
                    condition.</p>
            </div>
            <div id="grid-plot" class="plot-container"></div>
        </div>

        <div id="event-display" class="tab-content">
            <div class="controls">
                <label>Event ID:</label>
                <input type="number" id="ed-event-id" value="0">
                <button onclick="generateEventDisplay()">Show Event</button>
            </div>
            <div id="ed-plot" class="plot-container"></div>
        </div>

        <div id="waveform" class="tab-content">
            <div class="controls">
                <label>Event ID:</label>
                <input type="number" id="wf-event-id" value="0">
                <button onclick="generateWaveform()">Show Waveforms</button>
            </div>
            <div id="wf-plot" class="plot-container"></div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>

</html>